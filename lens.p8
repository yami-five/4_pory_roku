pico-8 cartridge // http then//www.pico-8.com
version 42
__lua__
-- lens_size,lens_r,lens_zoom,lens,lens_x,lens_y,x_speed,y_speed,g,b,damping=40,20,8,{},64,-50,4,0,0.2,1,0.99
-- t=0
function init_lens()
	local ls,d,r2=lens_r,lens_zoom,lens_r*lens_r
	for y=0,ls,1 do
		local y2=y*y
		for x=0,ls,1 do
			local x2=x*x
			if(x2+y2<r2)then
				local shift = d/sqrt(d*d-(x2+y2-r2))
				ix = flr(x * (shift-1)+0.5)
				iy = flr(y * (shift-1)+0.5)
				lens[(ls-y)*lens_size+(ls-x)]={ix,-iy} --left up
				lens[(ls+y)*lens_size+(ls+x)]={-ix,iy} --right down
				lens[(ls+y)*lens_size+(ls-x)]={ix,iy} -- left down
				lens[(ls-y)*lens_size+(ls+x)]={-ix,-iy} -- right up
			else
				lens[(ls-y)*lens_size+(ls+x)]=32767
				lens[(ls+y)*lens_size+(ls+x)]=32767
				lens[(ls-y)*lens_size+(ls-x)]=32767
				lens[(ls+y)*lens_size+(ls-x)]=32767
			end
		end
	end
end

function update_lens()
	if t>450 then lens_y+=1
	else
		y_speed+=g
		lens_x+=x_speed
		lens_y+=y_speed
		if lens_y+lens_r>127 then
			lens_y=127-lens_r
			y_speed=-y_speed*b
			x_speed*=damping
			y_speed*=damping
		end
		if lens_x-lens_r<0 then
			lens_x=lens_r
			x_speed=-x_speed*b
			x_speed*=damping
			y_speed*=damping
		end
		if lens_x+lens_r>127 then
			lens_x=127-lens_r
			x_speed=-x_speed*b
			x_speed*=damping
			y_speed*=damping
		end
		x_speed*=damping
		y_speed*=damping
		if abs(x_speed)<0.01 then x_speed=0 end
		if abs(y_speed)<0.01 then y_speed=0 end
	end
end

function draw_lens(lens_x,lens_y)
	local buf={}
	for y=-lens_r,lens_r do
		for x=-lens_r,lens_r do
			local off = lens[(y+lens_r)*lens_size+x+lens_r]
			if(off!=32767)then
				col=pget(lens_x+off[1],lens_y+y+off[2])
				buf[(y+lens_r)*lens_size+x+lens_r]=col
			end
		end
	end
	for y=-lens_r,lens_r do
		for x=-lens_r,lens_r do
			if(buf[(y+lens_r)*lens_size+x+lens_r]!=nil)then
				if((x+y)%4!=0)then
					pset(x+lens_x,y+lens_y,buf[(y+lens_r)*lens_size+x+lens_r])
				else
					pset(x+lens_x,y+lens_y,1)
				end
			end
		end
	end
	circ(lens_x,lens_y,20,1)
	circfill(lens_x+14,lens_y-4,3,7)
	circfill(lens_x+10,lens_y-10,2,14)
end

-- function _update()
-- 	t+=1
-- end

-- function _draw()
-- 	cls()
-- 	spr(0,0,0,16,16)
-- 	update_lens()
-- 	draw_lens(lens_x,lens_y)
--     print(t,7)
-- end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000066666666600000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000066676677667666600000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000006667777677677777666600000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000666777777776677766667666000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000006677777777667777677766776660000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000067777777766676666667766677760000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000006676777777667777776667667767776000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000066767667766677777766777767766777600000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000667767767667677777677777776667777660000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000677776666677767777677777667767777660000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006777776677767766677677766777777777666000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000677666677777667777677d6677777777677766600000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000677667677777777dd765d6dd677777777767776666000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000067777677777776d5555dddded67777777767776776660000000000000000000000000000000000000000000000
0000000000000000000000000000000000000667776677777d5254d4d4dddded6677777777767777760000000000000000000000000000000000000000000000
000000000000000000000000000000000000067777677776d54d5d5d5d4ddddfff66677777667777760000000000000000000000000000000000000000000000
0000000000000000000000000000000000000677766777d52ddd45454d5ddd6e6ff7667766666676760000000000000000000000000000000000000000000000
000000000000000000000000000000000000067766776554dd45dd5d5d4d4dddff77776766677666666000000000000000000000000000000000000000000000
0000000000000000000000000000000000000066777625454ddd54d4d5d5dded6ff7777666766777667660000000000000000000000000000000000000000000
0000000000000000000000000000000000000666667d25d5d5dd4d5d54d4dddedf77777766766677766766000000000000000000000000000000000000000000
000000000000000000000000000000000006667666765d5d4dd4d5d54d55dddd6f777777d6777667776776000000000000000000000000000000000000000000
000000000000000000000000000000000066777677675445d5dd5d4d5d4ddde6ef77777666767766666766000000000000000000000000000000000000000000
00000000000000000000000000000000006777667766d5d45ddd4d54d5ddddde6f77777766666777667760000000000000000000000000000000000000000000
0000000000000000000000000000000000667766676762554d4dd5dd54dddd6dff77777766776667777660000000000000000000000000000000000000000000
0000000000000000000000000000000000066666676665d4d5dd4d454ddddedffff6f6776d676666667760000000000000000000000000000000000000000000
000000000000000000000000000000000000676677766d455ddddd5dddddefddd55555576d776776666660000000000000000000000000000000000000000000
00000000000000000000000000000000000067666666d554ddd4d5454ddddd65555de6f776677767766600000000000000000000000000000000000000000000
00000000000000000000000000000000000067667667d4d525515555d4ddd55105255df777d76666760000000000000000000000000000000000000000000000
00000000000000000000000000000000000066776667655555540105d545410005555d5d777d5d56766000000000000000000000000000000000000000000000
00000000000000000000000000000000000067777767dd55254000004ddd55006fd6fdd667752ddd660000000000000000000000000000000000000000000000
00000000000000000000000000000000000066676677ddd2155550005ddde525f6d55677777d5dd6000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000676676d400e6df7f1005567f500055567f77751766000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000066750dd55d6d55d502d5f77f5525dddf7f775576d000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006d05e5dd5551505ddd26777ddddddde6f776d756000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000d501dd55d555555ddd56777edddd4d6ff7777650000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006d50dd45254554dddd467777ddd5dde6f777f560000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006dd05ddd4d5d4ddddd5d777ffedd5ddef7760600000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000006df54ddddd54dddddd4d777f6fdd4dd6f67d1600000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000d5ddd5dd4d554ddddd5f77f6ddd5dddf7765600000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000d2d5d4d5d4dd545dd25f77d5d545dde7767760000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000005255d5d5d55d55dd05fd5545d55dd6f766760000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000065dd45455545554000d556625d4ddf7766760000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000006d75d55455525d55505f7f6d25dde6f766776000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000067755455252555dddd5d7f7f555ddff766776600000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000677d25525555dddd5d5d7777d0dd6f77d6777600000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000667655555255dddd2525555d5056ef7667777760000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000006677d2525525dd5000054dddfd56676577777760000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000067776525255250002525dff67fdd771d77767760000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000006777775255552522525505de6d6f755777777760000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000006777777d552555555525dd6d66d7557677776760000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000677777755552525dddf777f6e6d57f677766760000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000006777677d2525555dddd776f66d577f677766760000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000006776677d5555525dd5566f66d5f7f7d67766760000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000006776677d5dd5155d5525d6dd5f777f676776760000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000677676d545d52525500055577f77f677667760000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000067776765d545d5510112d67ff7f76677667760000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000677667755d555545452d7fff6f77e677767760000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000666776545d4545d555df6f6f77fd677776600000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000006776755d55d555452df6f6ff76d567776600000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000667766554d5545d555d7f6f67fd5d77777660000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000067777600555d555452dff6f6ed56777777776000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000667777760045545d555d66ddd5567777777776600000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000066777777771045545d5454d5d25677767777777600000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000067777777777505d545d555522d7776777777777666660000000000000000000000000000000000000000
00000000000000000000000000000000000000000666677777777777d502d555d25dd77777777777777667766000000000000000000000000000000000000000
0000000000000000000000000000000000000000677667777777777777d554d45d67777777777777777767777666600000000000000000000000000000000000
000000000000000000000000000000000000006677767777766777777776d5555777777767777e67777dd7777777766600000000000000000000000000000000
000000000000000000000000000000000006667777667777666777777667762576677777666774d777d116777777777766000000000000000000000000000000
0000000000000000000000000000000066677777776777d66677777766777755677677777766dffd67111d777777777777666000000000000000000000000000
000000000000000000000000000000066777777777d77ddf77777776677777556777677766d6977fd7111d77777777777776d660000000000000000000000000
00000000000000000000000000000667d6677777764d97f6677773377777775d77777677f4777deff77111d777777777777fd2d6000000000000000000000000
0000000000000000000000000006677742d777777dff4ff67d2233367777775d77777767747769ae667111377777777777d64477660000000000000000000000
00000000000000000000000006677777d67677776dde69677222333d777777dd7777777d22df9674fd7111d777777777764de677760000000000000000000000
000000000000000000000000677677767edf777766edef67e9222337777777d677777772222da44f7fe111d6777777777d2e7676760000000000000000000000
00000000000000000000000067676777752677776e79e6d999223336777777d67777767222267f9e7dd1111d777777777e467777776000000000000000000000
000000000000000000000006f66766677ff76776d4df66f99922333d777777d677766722227fe6aed9d631167776777744777777776000000000000000000000
00000000000000000000006677de6f6d67767777666615da99223337766677677767772222aaa966f99961177777777d42677777766600000000000000000000
0000000000000000000666776677d576672f7777777111da9992333777776666767772222faaaf777999111d77677776df67777776f660000000000000000000
00000000000000000667767776f6de677d467777777d111e99923334777777766777222227aaadd6699ed1117777777767777776dd7760000000000000000000
00000000000000006777677777d67777667777777776111f9997d33227777767777222227faaf333599f11114d67777f67777766dde676600000000000000000
00000000000000006777677777766776677777777776111e999ad33322277677662222227aaaf333999911152dd67776777766f7e66777600000000000000000
000000000000000067777777776df76de6777777777d111e999a333322222222222222277aaa733399941115467d677777777f66767777760000000000000000
00000000000000006776777777d7767666777777767d111d999aa3332222222222222277aaaf7333999d11d246774677677766f77d6777760000000000000000
00000000000000006776777777d76f6f7667777767761116999aa3337772222222227777aaaf733d999111524777267777777e677f6677776000000000000000
0000000000000006776777777767776e6d677766777611169999a333777777722777777aaaf733399991111226744f76777766777e6767776000000000000000
0000000000000006776777777677766f6d77776d7776111d9999a333377777777777777aaa7733399995112222de6677776676677766df776000000000000000
00000000000000677767777776776f6d766777dd77761115e99973333777777777777faaaa7733d9999111244e674f7776764d66777667776000000000000000
0000000000000067767777776776767fd67777d477661115999963333777777767777aaaf773336999d111dd66d45767777e77f7677777776000000000000000
000000000000067776777777677f6e77667777e5d7f21112d99976333aa777777777faaa7763339999711d467f227777666767dd667767777600000000000000
000000000000067776777776776d776d776777dd76fd5113e999773333aaf777777faaaf773336999931122ed24777667fde646ff76776777600000000000000
00000000000006776777777777777766776777dd777771127f99f73333aaaa7777aaaaa7733336e99d1115d22477767667667e66777677777600000000000000
00000000000006776777777777777677776776f6664d6111df999773333aaaaaaaaaaaa733333d999611d6ed67776777667767f6677766677600000000000000
00000000000006776777777777776777776777e6642661116f999773333aaaaaaaaa7777333369999d1167777dd7777777677767f77777677600000000000000
000000000000677767777777777767777767777ddfdd2411d7e99773333377aaaa777777333999996111d767de66777777767776677777667600000000000000
00000000000067776777777777776777776777777777d711137999776333377777777733336999967113e766767777777777677f677777777600000000000000
00000000000067767777777777767777776777777777671111f999777333333777773333379999961116d67d6776777777777677777777777600000000000000
000000000000677677777777776777777767777767776761117e99977733333333333333379999711117f66e7767776777777767777777767760000000000000
000000000000677677777777776777777767777777676de111d7999f77773333333333377999997111177de77767767777777776777777777760000000000000
00000000000067767777777777677777776777777d76ed7211d7999e777773333333337799999761116776d77777776777777777677777767776000000000000
000000000006677677777777776777777767777776f6d6661156799997777777337777779999771111766f677677776777777777767777776776000000000000
00000000000677767777767777677777776777777776e667711167999e7777767777777999997611117e66767777776777777777767777767776000000000000
0000000000067767777776777767777777677777767777777111d7e9999e77676777779999776111d776df767677777677777777767777776777600000000000
00000000000677677777767776777777767677777777767676111d779999ff7666776999997711116777dde77777776777777777767777776777760000000000
00000000000677677777767776777777677677777777767767611167f9999999999e9999e7761111677776777677776777777777767777776777760000000000
0000000000067767777777677677777767767777776777777771111d7ff9999999999999776111d6777776776777776777777777767777776777760000000000
0000000000067767777777677677777767776777776666d67776d111d77f99999999999777111177777776776777776777777777766777776777760000000000
000000000006776777777767767777776777677777767e67777771111d67777e9999977761111d7777776f777777766777777777677667777677760000000000
00000000000067677777776776777777677767777776ed6777777dd11117777777777777111167777777d7776777677677777777677767777677760000000000
000000000000676777777767767777777677677777776e7777777771111116777767111111117776777677777777777677777777677767777677760000000000
00000000000066777777776776777777767767777777677777777776d31111111111111111177776777777776777777677777777767767777677760000000000
00000000000006777777776776777777767776777777677777777777771111111111111177777776777777777777776777777777767776777677760000000000
00000000000006777777776776777777767776777777677777777777777dd61111111d1677777767777777767777776777777777767776777677776000000000
000000000000067777777776767777777677777777776777777777777777776d6666777777777767777777767777776777777777767776777677776000000000
